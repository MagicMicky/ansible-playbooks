---
# Server Base Configuration Playbook
# Configures base system: packages, Docker, users
# Uses shared server-base role

- name: Configure Server Base
  hosts: all
  become: yes

  vars:
    # User configuration
    server_users:
      - name: magicmicky
        shell: /bin/zsh
        groups: ['sudo', 'docker']
        ssh_key: "ssh-rsa AAAAB3NzaC1yc2EAAAADAQABAAABAQDEpOmJsKsRUnb0yeqx1hPCCLBJDuiaOUVnqtw9OZEwSm/tWLXG6iVcqIi4QxUnnGyncVUcK9SKgMUIWkz5KzhVJn1XRHbiqYVctQDunGlybXFmd++sLQrJXfCMfAhH0JCLla0pSW6N4hzH2XLLfXf68w+DnM+AxEoaFlQLwM0ng3ZFZ+Ia4gfj+SmPVcsFlQOLUpoK9Ab7jsU9vGP6agfUPQs365WKYjmYmEIPypE+3+8lQ/p7xEZMjB9iIBpjJvX/Wkb4kQXRTWgOX13p/ghkzbo7pyWuwfpQeeBWnqSgTX+95AcY6i7HG1W+6s8MTtXFxjH9uSrpgX72qsLTlx95"
      - name: ansible
        groups: ['docker']
        ssh_key: "ssh-ed25519 AAAAC3NzaC1lZDI1NTE5AAAAIPX1LyZ6ERT25LPhnuaeJrKThetmklrbWoar+iRWhbFu ansible@trce"

    # Package configuration
    install_docker: true

  pre_tasks:
    - name: Display deployment information
      debug:
        msg: |
          Configuring base system for {{ inventory_hostname }}
          Installing: packages, Docker, users

  roles:
    - role: server-base
      tags: ['base', 'packages', 'docker', 'users']

  post_tasks:
    - name: Display completion message
      debug:
        msg: |
          Base server configuration complete for {{ inventory_hostname }}

          Installed:
          - Base packages: git, htop, tar, zsh, acl, unzip, curl
          - Docker and Docker Compose
          - Users: magicmicky, ansible (with SSH keys)

          Next steps:
          - Run shell-setup.yml to configure modern shell
          - Verify Docker: docker ps
          - Verify users: id magicmicky
