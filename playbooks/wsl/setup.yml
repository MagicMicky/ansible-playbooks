---
# WSL Setup Playbook
# Configures WSL environment with modern shell setup

- name: Configure WSL Environment
  hosts: localhost
  connection: local
  become: false

  vars_files:
    - vars/defaults.yml

  pre_tasks:
    - name: Display deployment information
      ansible.builtin.debug:
        msg: |
          Deploying modern shell configuration to WSL
          Machine Profile: {{ machine_profile }}
          Dotfiles Location: {{ dotfiles_dest | default('~/Development/dotfiles') }}
          Branch: {{ dotfiles_branch }}

    - name: Ensure prerequisites are installed
      ansible.builtin.apt:
        name:
          - zsh
          - git
          - curl
          - wget
          - build-essential
        state: present
        update_cache: true
      become: true
      tags: ['prerequisites']

  roles:
    - role: common-shell
      tags: ['shell', 'dotfiles']

    - role: app-config
      when: configure_apps | default(false)
      tags: ['apps', 'config']

  post_tasks:
    - name: Display completion message
      ansible.builtin.debug:
        msg: |
          WSL configuration complete!

          Next steps:
          1. Start a new shell: exec zsh
          2. Or set as default: chsh -s $(which zsh)

          On first startup:
          - Zinit will auto-install
          - Plugins will download automatically

          Your prompt should show: [Î»] in blue
