---
# Claude Code installation and configuration tasks

- name: Check if Claude Code is installed
  ansible.builtin.command: which claude
  register: claude_installed
  changed_when: false
  failed_when: false
  tags: ['claude']

- name: Install Claude Code
  ansible.builtin.shell: |
    curl -fsSL https://claude.ai/install.sh | bash
  args:
    creates: "~/.claude/bin/claude"
  when: claude_installed.rc != 0
  become: false
  tags: ['claude']

- name: Ensure ~/.claude directory exists
  file:
    path: "~/.claude"
    state: directory
    mode: '0755'
  become: no
  tags: ['claude']

- name: Link Claude Code settings
  file:
    src: "{{ dotfiles_repo_local_destination }}/claude/settings.json"
    dest: "~/.claude/settings.json"
    state: link
    force: yes
  become: no
  tags: ['claude']

- name: Link Claude Code statusline script
  file:
    src: "{{ dotfiles_repo_local_destination }}/claude/statusline.sh"
    dest: "~/.claude/statusline.sh"
    state: link
    force: yes
  become: no
  tags: ['claude']
